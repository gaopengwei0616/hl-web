<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>控制台页面</title>


    <link rel="stylesheet" href="css/style.default.css" type="text/css"/>
    <link rel="stylesheet" type="text/css" href="ztree/css/zTreeStyle.css"/>
    <script type="text/javascript" src="js/plugins/jquery-1.7.min.js"></script>
    <script type="text/javascript" src="ztree/js/jquery.ztree.core.js"></script>
    <script type="text/javascript" src="js/script.js"></script>
    <script type="text/javascript" src="js/MyPage.js"></script>
    <link rel="stylesheet" type="text/css" href="css/page.css"/>


    <!--[if lte IE 8]>
    <script language="javascript" type="text/javascript" src="js/plugins/excanvas.min.js"></script><![endif]-->
    <!--[if IE 9]>
    <link rel="stylesheet" media="screen" href="css/style.ie9.css"/>
    <![endif]-->
    <!--[if IE 8]>
    <link rel="stylesheet" media="screen" href="css/style.ie8.css"/>
    <![endif]-->
    <!--[if lt IE 9]>
    <script src="js/plugins/css3-mediaqueries.js"></script>
    <![endif]-->
</head>
<script type="text/javascript">
    $(function () {
        $('#all').click(function () {

            if ($(this).prop('checked')) {
                $('#datalist :checkbox').prop('checked', true);
            } else {
                $('#datalist :checkbox').prop('checked', false);
            }

        });

        var siteid = $("#siteid").val();
        if(siteid==1){
            $.ajax({
                url:"/showSites",
                dataType:"json",
                type:"post",
                success:function (data) {
                    var html = "";
                    for(var i in data){
                        html += "<option value='"+data[i].siteid+"'>"+data[i].name+"</option>";
                    }
                    $("#siteSelect").append(html);
                    $("#siteSelect").val($("#siteid").val());
                }
            });
        }else{
            $("#siteSelec").hide();
        }
    });
    $(function () {
        var siteid = $("#siteid").val();
        $.ajax({
            url: "/catParentDirList?siteid="+siteid,
            type: "get",
            dataType: "json",
            success: function (data) {
                var zTree;
                var setting = {
                    view: {
                        dblClickExpand: false,
                        showLine: true,
                        selectedMulti: false
                    },
                    data: {
                        key: {
                            url: ""
                        },
                        simpleData: {
                            enable: true,
                            idKey: "catid",
                            pIdKey: "parentid",
                            rootPId: ""
                        }
                    },
                    callback: {
                        beforeClick: function (treeId, treeNode) {
                            var zTree = $.fn.zTree.getZTreeObj("tree");
                            if (treeNode.isParent) {
                                zTree.expandNode(treeNode);
                                return false;
                            } else {
                                return true;
                            }
                        },
                        onClick: zTreeOnClick
                    }
                };
                var zNodes = data;
                var t = $("#tree");
                t = $.fn.zTree.init(t, setting, zNodes);
            }
        });

    })
    function zTreeOnClick(event, treeId, treeNode) {
        var siteid = $("#siteid").val();
        var catid = treeNode.catid;
        window.location.href = "/showLists?catid=" + catid+"&siteid="+siteid;
    }
</script>

<body>

<div class="pageheader">
<ul class="breadcrumbs">
    <li><a href="">内容</a></li>
    <li><a href="">栏目管理</a></li>
    <li>惠来新闻</li>
</ul>
</div><!--pageheader-->
<div id="contentwrapper" class="contentwrapper">
    <input type="hidden" id="siteid" th:value="${siteid}" />
    <div class="one_fifth dashboard_left">
        <ul id="tree" class="ztree" style="overflow-y:scroll;overflow-x: hidden;height: 550px;"></ul>
    </div><!--two_third dashboard_left -->

    <div class="three_fourth last dashboard_right" id="datalist">

        <div style="margin-bottom: 5px">
            <button class="stdbtn btn_black" onclick="add_news_data()">添加新闻</button>
            <button class="stdbtn btn_black" onclick="changUrl('/showLists');">管理内容</button>
            <span id="siteSelec" style="float: right">
                <label>站点</label>
                <span class="field" >
                <select  id="siteSelect" style="width:400px;padding: 8px;">
                </select>
                </span>
            </span>

        </div>
        <table cellpadding="0" cellspacing="0" border="0" class="stdtable" id="dyntable2">
            <colgroup>
                <col class="con1"/>
                <col class="con0"/>
                <col class="con1"/>
                <col class="con0"/>
                <col class="con1"/>
            </colgroup>
            <thead>
            <tr>
                <th class="head0">ID</th>
                <th class="head1"style="width: 30%">标题</th>
                <th class="head0">发布人</th>
                <th class="head1">更新时间</th>
                <th class="head0"style="width: 30%">管理操作</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="list:${pageList}">
                <td th:text="${list.id}"></td>
                <td><a href="javascript:"
                       th:text="${list.title}"></a></td>
                <td th:text="${list.username}"></td>
                <td th:text="${list.updatetime}"></td>
                <td>
                    <button class="stdbtn btn_black" th:onclick="'javascript:edit_news_data(\''+${list.id}+'\')'">修改</button>
                    <button class="stdbtn btn_black" th:onclick="'javascript:del_news_data(\''+${list.id}+'\')'">删除</button>
                </td>
            </tr>
            </tbody>
        </table>
        <div class="pages">
            <span th:text="'显示'+${page.pageSize}+'条'"></span>
            <span id="page_total" th:value="${page.total}"
                  th:text="'共有'+${page.total}+'条记录'"></span>
            <span th:value="${page.pages}" th:text="'共有'+${page.pages}+'页'"></span>
            <span class="page" id="Page" style="float: right"></span>
        </div>
        <input type="hidden" id="catid" th:value="${catid}"/>
        <input type="hidden" id="value" th:value="${value}"/>
        <script>
            var total = $("#page_total").attr("value");
            P.initMathod({
                params: {
                    elemId: '#Page',
                    total: this.total
                }, requestFunction: function (pageIndex) {
                    if ($("#value").val() == 1) {
                        $("#value").val(0);
                        return;
                    }
                    var catid = $("#catid").val();
                    window.location.href = "/showLists?catid=" + catid + "&pageNum=" + pageIndex;
                }
            });
        </script>
    </div><!--one_third last-->


    <div id="activities" class="subcontent" style="display: none;">
        &nbsp;
    </div><!-- #activities -->

</div><!--contentwrapper-->

<br clear="all"/>


<script>
    /**
     * 根据newsId修改news_data的数据
     * @param id
     */
    function edit_news_data(id) {
        var catid = $("#catid").val();
        if(catid==null||catid==undefined||catid=="".trim()){
            alert("请选择栏目");
            return false;
        }
        var w = screen.width;
        var h = screen.height;
        window.open("/add_edit_newsData?news_id=" + id + "&catid=" + catid + "&type=edit", name, "top=100,left=400,width=" + w + ",height=" + h + ",toolbar=no,menubar=no,scrollbars=yes,resizable=yes,location=no,status=no");
    }

    function add_news_data() {
        var catid = $("#catid").val();
        if(catid==0){
            alert("请选择栏目");
            return false;
        }
        var w = screen.width;
        var h = screen.height;
        window.open("/add_edit_newsData?&catid=" + catid + "&type=add", name, "top=100,left=400,width=" + w + ",height=" + h + ",toolbar=no,menubar=no,scrollbars=yes,resizable=yes,location=no,status=no");
    }

    function del_news_data(id) {
        if(confirm("是否删除")){
            $.ajax({
                url: "/del_news_data?id=" + id,
                dataType: "json",
                type: "get",
                data: {"id": id},
                success: function (data) {
                    alert("删除成功");
                    window.location.reload();
                }
            })
        }

    }

    $("#siteSelect").change(function () {
       var siteid = $(this).val();
       window.location.href = "/showLists?siteid="+siteid;
    });
</script>
</body>
</html>